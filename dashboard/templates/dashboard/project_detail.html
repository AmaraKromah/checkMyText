{% extends "dashboard/index.html" %}

{% block title %} {{userfile.name}} {% endblock %}

{%block content %}


<h1> Project</h1>

<ul>
    <input type="hidden" id="project_id" value="{{userfile.id}}">
    Eigennaar: {{userfile.get_owner_full_name}}<br>
    Bestandsnaam: {{userfile.name}}<br>
    Thema: {{userfile.thema}}<br>
    Aantal woorden: {{userfile.word_count}}<br><br>
    Upload datum: {{userfile.upload_date}}<br>
    Accept datum: <span id="accept_date">{{userfile.accept_date|default_if_none:"None"}}</span> <br><br>

    Eind datum: {{userfile.end_date|date:"l d M Y"}}<br>
    Eind tijd: {{userfile.end_date|date:"H:i:s"}}<br><br>
    Prijs: {{userfile.price}}<br>
    {%if userfile.checker %}
        File: <a href="{{userfile.file.url}}">{{userfile.file}}</a><br>
    {% else %}
    <span id="project_sample">sample:{{sample|linebreaks}}<br></span>
    {% endif  %}
    <span id="project_file"></span>

    <p> Checker: <span id="checker_id">{{userfile.get_checker_full_name}}</span></p>
    {% if request.user.userprofile.user_type.name == "checker" %}
        {% if not userfile.checker %}
        <form onsubmit="return false">
            {% csrf_token %}
            <button id="confirm" onclick="ConfirmProject()">Bevestigen</button>
        </form>
        {% endif %}
     {% endif %}
    <p id="cancel_time"></p>


    <br>
</ul>

<a href="#" onclick="goBack();return false;">Terug</a>
<p><a href="{% url 'dashboard' %}">dashboard</a></p>
{% endblock %}

{% block javascript %}

<script>
    remove_unwanted_tags();
    function goBack() {
        location.replace(document.referrer);
    }
    function ConfirmProject() {
        var checker = $("#checker_id").text();
        $.ajax({
            type: "POST",
            url: "{% url 'confirm_project' %}",
            dataType: "json",
            async: true,
            data: {
                csrfmiddlewaretoken: '{{csrf_token}}',
                project_id: parseInt($('#project_id').val())
            }
        }).done(function (json) {
            if (json.result === "no checker") {
                $("#checker_id").text(json.checker);
                var accept_date = moment(json.accept_date).format("D MMMM YYYY HH:mm:ss");
                $("#accept_date").text(accept_date);
                $("#confirm").remove();
//                    console.log(json.file_name, json.file_url);
                $("#project_file").html(' File: <a href="{{userfile.file.url}}">{{userfile.file}}</a><br>');
                $("#project_sample").remove();
                }
        });
    }
    function remove_unwanted_tags() {
        if ("{{userfile.checker}}".toString() !== "None"){
            $("#project_file").remove();
        }
    }


</script>
{% endblock %}









